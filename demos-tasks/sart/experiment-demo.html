<!DOCTYPE html>
<html>
<head>
  <title>PDS jsPsych Demo</title>

  <!-- Load libraries -->
  <script src="../../lib/jspsych-7.3.0/dist/jspsych.js"></script>

  <!-- Load jsPsych plug-ins -->
  <script src="../../lib/jspsych-7.3.0/dist/plugin-html-button-response.js" type="text/javascript"></script>
  <script src="../../lib/jspsych-7.3.0/dist/plugin-html-keyboard-response.js" type="text/javascript"></script>

  <!-- Load CSS styles -->
  <link href="../../lib/jspsych-7.3.0/dist/jspsych.css" rel="stylesheet" type="text/css"></link>
	
</head>
<body></body>
<script>

// Initialize jsPsych
	
var jsPsych = initJsPsych({
      //show_progress_bar: true,
      on_finish: function() {
      //jsPsych.data.displayData(); 
       },
      on_trial_start: function() {
       },
      on_trial_finish: function(){
       },
    });	
	
	
// Initialize timeline.
var timeline = [];

	
// ADD CODE BELOW -------------------------------------------------------------------------------------------------------------

	
 var startDemo = {
      
      type: jsPsychHtmlButtonResponse,
      stimulus: `
       <p><img src="data:image/png;base64,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" width="200" height="auto"></p>
      
       <p style="font-size:25px;border: 0px solid #000;border-radius: 5px; color:#222;padding: 8px; font-family: sans-serif">Bienvenue</p><hr>
       <p>Merci d'avoir accepté de participer.</p>
       <p style="font-size:18px">Pour commencer, veuillez cliquer sur <i>Continuer</i>.</p>
  `,
      choices: ['Continuer'],
      on_start: function(){
      },
      on_finish: function(){
      },
    };
    
    timeline.push(startDemo);
	
	
  var stimuliTemps = 250;               // Temps presentation stimuli
    var allowedTime = 900;                // Temps de réponse
    var numberPossible = 8;          // Intervalle possible check écoute
    var chooseTarget = "5,a";               // Cible SART brute     ex: "a,B,2"
    var chooseTarget2 = ['5','A'];              // Cible SART tableau   ex: ['A','B','2'] avec A, B et 2 en cibles.
    var chooseProb = 5;                 // Probabilité de cible, combien de fois plus probable ? 2X ? 3X ? 
    
    // DEF TEMPS SART (en minutes)
    var timeSart1 = 0.5;              // TRAINING 1
    var timeSart2 = 0.5;              // TRAINING 2
    var timeSart3 = 0.5;              // SART 1 
    var timeSart4 = 0.5;             // SART 2 
    
    // SOUND USED
    var soundForSartSlow = [        // Sons pour la SART lente
     'audio/0_ACDC.mp3',
     'audio/1_ACDC.mp3',
     'audio/2_ACDC.mp3',
     'audio/4_ACDC.mp3',
     'audio/5_ACDC.mp3',
     'audio/6_ACDC.mp3',
     'audio/7_ACDC.mp3',
     'audio/8_ACDC.mp3',
     'audio/9_ACDC.mp3',
      ];
    var soundForSartFast = [        // Sons pour la SART Rapide
     'audio/0_ACDC.mp3',
     'audio/1_ACDC.mp3',
     'audio/2_ACDC.mp3',
     'audio/4_ACDC.mp3',
     'audio/5_ACDC.mp3',
     'audio/6_ACDC.mp3',
     'audio/7_ACDC.mp3',
     'audio/8_ACDC.mp3',
     'audio/9_ACDC.mp3',
      ]; 
      
      var preloadC = {
      
      type: jsPsychPreload,
      audio: [
      'audio/0_ACDC.mp3',
     'audio/1_ACDC.mp3',
     'audio/2_ACDC.mp3',
     'audio/4_ACDC.mp3',
     'audio/5_ACDC.mp3',
     'audio/6_ACDC.mp3',
     'audio/7_ACDC.mp3',
     'audio/8_ACDC.mp3',
     'audio/9_ACDC.mp3',
      ]
    };
    
        

  

var targetAvoid = {
      
      type: jsPsychHtmlButtonResponse,
      //prompt: "<p></p><b>Etape 2</b>",
      stimulus: function(){
     return `<p style="font-size:30px; color:black;">Cibles à éviter :</p><hr>
                 <p><i>Ne cliquez pas si les cibles suivantes s'affichent.</i></p><p><strong>${chooseTarget2.join(" -  ")}</strong></p><p></p>`
      }, 
      choices: ['Continuer'],
    };
    


      var possibleTrack =  jsPsych.randomization.shuffle([soundForSartFast, soundForSartSlow]);

      
    var chooseTrack;

    
    var startTask22 = {
      
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size:25px; color:black;">Lancement Partie 2</p><hr>
                 <p>Veuillez cliquer sur <strong>continuer</strong> pour débuter la tache.</p><p></p>`,
      choices: ['Continuer'],
       on_finish: function(){
      chooseTrack = jsPsych.randomization.shuffle(possibleTrack[0])
      chooseTrack = chooseTrack.slice(0,1)
      audio = new Audio(`${chooseTrack}`)//Audio('TEST1.wav');
      audio.play()
      return audio
      },
    };
    
//    timeline.push(startTask22);

      var training2 = {
      
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size:30px; color:black;">Entrainement Partie 2</p><hr>
                 <p>Veuillez cliquer sur <strong>continuer</strong> pour débuter la tache.</p><p></p>`,
      choices: ['Continuer'],
      /*on_finish: function(){
      audio = new Audio('TEST2.wav');
      audio.play()
      return audio
      },*/
    };
    
    var aftertraining2 = {
      
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size:28px; color:black;">Fin entrainement</p><hr>
                 <p>Vous avez compris ? C'est parti pour le vrai essai.</p>
                 <p>Veuillez cliquer sur <strong>continuer</strong> pour lancer l'écoute.</p><p></p>`,
      choices: ['Continuer'],
    };
    
    var aftertraining22 = {
      
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size:28px; color:black;">Entrainement</p><hr>
                 <p>Vous avez compris ? Maintenant nous ajoutons le son et on recommence une seconde fois.</p>
                 <p>Veuillez cliquer sur <strong>continuer</strong> pour lancer l'écoute.</p><p></p>`,
      choices: ['Continuer'],
      on_finish: function(){
      chooseTrack = jsPsych.randomization.shuffle(possibleTrack[0])
      chooseTrack = chooseTrack.slice(0,1)
      audio = new Audio(`${chooseTrack}`)//Audio('TEST1.wav');
      audio.play()
      return audio
      },
    };
    
        var afterLoop1 = {
      
      type: jsPsychHtmlButtonResponse,
      stimulus: `<p style="font-size:30px; color:black;">Pause</p><hr>
                 <p>Prenez une petite pause et on recommence une seconde fois.</p>
                 <p>Veuillez cliquer sur <strong>continuer</strong> pour lancer l'écoute.</p><p></p>`,
      choices: ['Continuer'],
      on_finish: function(){
      chooseTrack = jsPsych.randomization.shuffle(possibleTrack[1])
      chooseTrack = chooseTrack.slice(0,1)
      audio = new Audio(`${chooseTrack}`)//Audio('TEST1.wav');
      audio.play()
      return audio
      },
    };
    
//    timeline.push(aftertraining2);
    
//    timeline.push(training2);
    
   var subjectResponse = null;
   var subjectResponseA = null;
   var isTarget;
   var target = 1; 
   var stimNumber;
   
   // Pour les résultats ! 
   var numbOfMistake = 0;
   var numbOfCorrect = 0;
   var numbOfTarget = 0;
   var numbOfSlow = 0;
   
  
  var targetNumber = ['0', '1', '2', '3', '4', '5', '6', '7' ,'8', '9']
  var targetLetter = ['A','B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'Y', 'Y', 'Z']
  var possibleTarget = targetNumber.concat(targetLetter).concat(targetNumber)
  
  //var possibleTarget = ['0', '1', '2', '3', '4', '5', '6', '7' ,'8', '9']
  var weightedProba
  var j = 1
  
  var falsed = {
      
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `<b>Chargement en cours</b>`,
      choices: "NO_KEYS",     
      post_trial_gap: 0,
      trial_duration: 50, // value in ms
    };
    
  //timeline.push(falsed);
    
  var weightTarget = {
    timeline: [falsed],
    post_trial_gap: 0,
    on_start: function(){
      weightedProba = parseInt(chooseProb)
          console.log(weightedProba)
          return weightedProba
    },
    loop_function: function(){        
      while(j < weightedProba){
          if(j === weightedProba-1){
             j ++
             possibleTarget = possibleTarget.concat(chooseTarget2)
             console.log(possibleTarget)
             possibleTarget = jsPsych.randomization.shuffle(possibleTarget)
             console.log(possibleTarget)
             return true
          } else {
             j ++
             possibleTarget = possibleTarget.concat(chooseTarget2)
             console.log(possibleTarget)
             return true
          }
        }
    }
  }
  
//  timeline.push(weightTarget);
  
  // _______________________________________________________________________________________
  // ICI CODE TACHE
 
   var newTarget
  
  //stim 
   var taskA = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function(){
      //stimNumber = Math.floor(Math.random()*10)
      stimNumber = jsPsych.randomization.shuffle(possibleTarget)
    //  console.log(stimNumber)
      stimNumber = stimNumber.slice(0, 1).toString()
      console.log(stimNumber)
      let sizeRandom = Math.floor((Math.random()*100)+10)
      target = chooseTarget
      console.log(`stim: ${stimNumber} target: ${target}`)
      
      return `<p style="font-size:${sizeRandom}px; color:black;">${stimNumber}</p>`
    },
    post_trial_gap: 0,
    trial_duration: function(){ // value in ms
      if(stimuliTemps === ""){
        return 250
      } else {
        return stimuliTemps
      }
    }, 
    response_ends_trial: true, //false prec.
    choices: " ", //"NO_KEYS" prec.
    prompt: "",
    on_finish: function(){
      
      subjectResponse = jsPsych.data.getLastTrialData().trials[0].response
      console.log(`rep is ${subjectResponse}`)
        if(subjectResponse === null) {
        subjectResponse = false
        console.log(`rep: ${subjectResponse}`)
        console.log(chooseTarget2.indexOf(stimNumber))
       // return subjectResponse
           if(chooseTarget2.indexOf(stimNumber) == "-1"){
            isTarget = false
            console.log(`target: ${isTarget}`)
            return isTarget
          } else {
            isTarget = true
             numbOfTarget ++
            console.log(`target: ${isTarget}`)
           return isTarget
           }
      } else {
        subjectResponse = true
        repTaskA = true
        jsPsych.data.write({repA: [true]})
        console.log(`rep: ${subjectResponse}`)
       // return subjectResponse
           if(chooseTarget2.indexOf(stimNumber) == "-1"){
            isTarget = false
            console.log(`target: ${isTarget}`)
            return isTarget
          } else {
            isTarget = true
             numbOfTarget ++
            console.log(`target: ${isTarget}`)
           return isTarget
           }
      }
      
    },
    data: {
        task: 'REPONSE'
      }
};

 // timeline.push(taskA);
 
   var repTaskA = false;
  
  //masque
   var taskB = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function(){
      return '<img src="img/0_NOIR.png" width="100" height="100" />'//'<p style="font-size:80px; color:black;">X</p>'
    },
    post_trial_gap: 0,
    trial_duration: function(){ // value in ms
      if(repTaskA === true){
        return 50
      }else if(allowedTime === ""){
        return 900
      } else {
        return allowedTime
      }
    }, 
    response_ends_trial: true, //false,
    //'<p style="font-size:48px; color:green;">BLUE</p>'
    choices: " ",
    prompt: "",
    on_finish: function(){
      if(repTaskA === true){
        repTaskA = false
        console.log("Deja rep")
      } else {
      subjectResponse = jsPsych.data.getLastTrialData().trials[0].response
      console.log(`rep is ${subjectResponse}`)
        if(subjectResponse === null) {
        subjectResponse = false
        console.log(`rep: ${subjectResponse}`)
       // return subjectResponse
      } else {
        subjectResponse = true
        jsPsych.data.write({repA: [false]})
        console.log(`rep: ${subjectResponse}`)
       // return subjectResponse
        }
      }
    },
    data: {
        task: 'REPONSE'
      }
};

 // timeline.push(taskB);
  
     var taskC = {
    type: jsPsychHtmlKeyboardResponse,
    on_start: function(){
      console.log(`Target: ${target} Stim: ${stimNumber} Response: ${subjectResponse}`)
    },
    stimulus: function(){
        if(subjectResponse === false  && isTarget === true){
         return '<img src="img/0_VERT.png" width="100" height="100" />'//'<p style="font-size:30px; color:green;"><b>Bonne réponse !</b></p><p style="font-size:30px; color:green;">Bien vu !</p>'
      } else if(subjectResponse === true && isTarget === false){
         return '<img src="img/0_VERT.png" width="100" height="100" />'//'<p style="font-size:30px; color:green;"><b>Bonne réponse !</b></p>'
      } else if(subjectResponse === true && isTarget === true){
         return '<img src="img/0_ROUGE.png" width="100" height="100" />'//'<p style="font-size:30px; color:red;"><b>Mauvaise réponse...</b></p>'
      } else if(subjectResponse === false){
        return '<img src="img/0_NOIR.png" width="100" height="100" />'//'<p style="font-size:30px; color:black;">Trop lent..</p>'
      }
    },
    post_trial_gap: 500,
    trial_duration: function(){
      return 1000
    }, // value in ms
    response_ends_trial: false,
    //'<p style="font-size:48px; color:green;">BLUE</p>'
    choices: "NO_KEYS",
    prompt: "",
    on_finish: function(){
      if(subjectResponse === false  && isTarget === true){
        numbOfCorrect ++
        console.log(`Nombre bonne: ${numbOfCorrect}`)
         return numbOfCorrect
      } else if(subjectResponse === true && isTarget === false){
        numbOfCorrect ++
        console.log(`Nombre bonne: ${numbOfCorrect}`)
         return numbOfCorrect
      } else if(subjectResponse === true && isTarget === true){
        numbOfMistake ++
        console.log(`Nombre erreur: ${numbOfMistake}`)
         return numbOfMistake
      } else if(subjectResponse === false){
        numbOfSlow ++
        console.log(`Nombre retard: ${numbOfSlow}`)
        return numbOfSlow
      }
    },
      
    data: {
        task: 'REPONSE'
      }
};

//  timeline.push(taskC);

var taskCbis = {
    type: jsPsychHtmlKeyboardResponse,
    on_start: function(){
      console.log(`Target: ${target} Stim: ${stimNumber} Response: ${subjectResponse}`)
    },
    stimulus: function(){
        if(subjectResponse === false  && isTarget === true){
         return '<img src="img/0_VERT.png" width="100" height="100" /><p><b>Bien vu !</b></p>'//'<p style="font-size:30px; color:green;"><b>Bonne réponse !</b></p><p style="font-size:30px; color:green;">Bien vu !</p>'
      } else if(subjectResponse === true && isTarget === false){
         return '<img src="img/0_VERT.png" width="100" height="100" /><p><b>Bonne réponse!</b></p>'//'<p style="font-size:30px; color:green;"><b>Bonne réponse !</b></p>'
      } else if(subjectResponse === true && isTarget === true){
         return '<img src="img/0_ROUGE.png" width="100" height="100" /><p><b>Ne pas appuyer pour la cible !</b></p>'//'<p style="font-size:30px; color:red;"><b>Mauvaise réponse...</b></p>'
      } else if(subjectResponse === false){
        return '<img src="img/0_NOIR.png" width="100" height="100" /><p><b>Trop lent !</b></p>'//'<p style="font-size:30px; color:black;">Trop lent..</p>'
      }
    },
    post_trial_gap: 500,
    trial_duration: function(){
      return 1000
    }, // value in ms
    response_ends_trial: false,
    //'<p style="font-size:48px; color:green;">BLUE</p>'
    choices: "NO_KEYS",
    prompt: "",
    on_finish: function(){
      if(subjectResponse === false  && isTarget === true){
        numbOfCorrect ++
        console.log(`Nombre bonne: ${numbOfCorrect}`)
         return numbOfCorrect
      } else if(subjectResponse === true && isTarget === false){
        numbOfCorrect ++
        console.log(`Nombre bonne: ${numbOfCorrect}`)
         return numbOfCorrect
      } else if(subjectResponse === true && isTarget === true){
        numbOfMistake ++
        console.log(`Nombre erreur: ${numbOfMistake}`)
         return numbOfMistake
      } else if(subjectResponse === false){
        numbOfSlow ++
        console.log(`Nombre retard: ${numbOfSlow}`)
        return numbOfSlow
      }
    },
      
    data: {
        task: 'REPONSE'
      }
};
   
    // pour le timer des loop
    var timeStartLoop;
    var timeEndLoop;
    var timeTargetSart1 = timeSart1*60;
    var timeTargetSart2 = timeSart2*60;
    var timeTargetSart3 = timeSart3*60;
    var timeTargetSart4 = timeSart4*60;
    // pour le compteur des loop 
    var k = 0;
   
    var loopTaskTraining = {
      timeline: [taskA, taskB, taskCbis],
      loop_function: function(){
        timeEndLoop = (Date.now()- timeStartLoop)/1000
        console.log(`Time spent is ${timeEndLoop}`)
        if(timeEndLoop < timeTargetSart1){
          return true 
        } else {
        console.log(`K is reset`)
        return k = 0
        }
      }, 
   //   repetitions: 10,
      on_start: function(){
        if(k === 0){
          k ++
          timeStartLoop = Date.now()
          console.log(`Date start is ${timeStartLoop}`)
        } else {
          
        }
      },
      randomize_order: false, 
    }; 
    
//   timeline.push(loopTask);

var loopTaskTraining2 = {
      timeline: [taskA, taskB, taskCbis],
      loop_function: function(){
        timeEndLoop = (Date.now()- timeStartLoop)/1000
        console.log(`Time spent is ${timeEndLoop}`)
        if(timeEndLoop < timeTargetSart2){
          return true 
        } else {
        console.log(`K is reset`)
        return k = 0
        }
      }, 
   //   repetitions: 10,
      on_start: function(){
        if(k === 0){
          k ++
          timeStartLoop = Date.now()
          console.log(`Date start is ${timeStartLoop}`)
        } else {
          
        }
      },
     // repetitions: 10,
      randomize_order: false, 
    }; 
    
//   timeline.push(loopTask);

  
    var loopTask1 = {
      timeline: [taskA, taskB, taskC],
      loop_function: function(){
        timeEndLoop = (Date.now()- timeStartLoop)/1000
        console.log(`Time spent is ${timeEndLoop}`)
        if(timeEndLoop < timeTargetSart3){
          return true 
        } else {
        console.log(`K is reset`)
        return k = 0
        }
      }, 
   //   repetitions: 10,
      on_start: function(){
        if(k === 0){
          k ++
          timeStartLoop = Date.now()
          console.log(`Date start is ${timeStartLoop}`)
        } else {
          
        }
      },
     // repetitions: 10,
      randomize_order: false, 
    }; 
    
//   timeline.push(loopTask);

var loopTask2 = {
      timeline: [taskA, taskB, taskC],
      loop_function: function(){
        timeEndLoop = (Date.now()- timeStartLoop)/1000
        console.log(`Time spent is ${timeEndLoop}`)
        if(timeEndLoop < timeTargetSart4){
          return true 
        } else {
        console.log(`K is reset`)
        return k = 0
        }
      }, 
   //   repetitions: 10,
      on_start: function(){
        if(k === 0){
          k ++
          timeStartLoop = Date.now()
          console.log(`Date start is ${timeStartLoop}`)
        } else {
          
        }
      },
     // repetitions: 10,
      randomize_order: false, 
    }; 
    
//   timeline.push(loopTask);


var resultsTraining0 = {
        type: jsPsychHtmlButtonResponse,
        stimulus:  function() {
        return     `<p style="font-size:30px; color:black;"><b>Résultats :</b></p><hr><p><b>${numbOfCorrect}</b> bonnes réponses.<p><p><b>${numbOfMistake}</b> erreurs.<p><p><b>${numbOfSlow}</b> fois trop lent.</p><p><i>Une cible est apparue <b>${numbOfTarget}</b> fois.</i></p>`
          
        },
        choices: ['Continuer'],
        post_trial_gap: 0,
      //  trial_duration: 50, // value in ms
        on_start: function(){
          //audio.pause()
          numbOfTarget --
        console.log(`Bon : ${numbOfCorrect} Mauvaise : ${numbOfMistake} Cible :${numbOfTarget} Lent :${numbOfSlow} `)
        },
        on_finish: function(){
          numbOfSlow = 0
          numbOfTarget = 0
          numbOfMistake = 0
          numbOfCorrect = 0
          console.log("RESET counter")
        },
      };
      
var resultsTraining1 = {
        type: jsPsychHtmlButtonResponse,
        stimulus:  function() {
        return     `<p style="font-size:30px; color:black;"><b>Résultats :</b></p><hr><p><b>${numbOfCorrect}</b> bonnes réponses.<p><p><b>${numbOfMistake}</b> erreurs.<p><p><b>${numbOfSlow}</b> fois trop lent.</p><p><i>La cible est apparue <b>${numbOfTarget}</b> fois.</i></p>`
          
        },
        choices: ['Continuer'],
        post_trial_gap: 0,
      //  trial_duration: 50, // value in ms
        on_start: function(){
          audio.pause()
          numbOfTarget --
        console.log(`Bon : ${numbOfCorrect} Mauvaise : ${numbOfMistake} Cible :${numbOfTarget} Lent :${numbOfSlow} `)
        },
        on_finish: function(){
          numbOfSlow = 0
          numbOfTarget = 0
          numbOfMistake = 0
          numbOfCorrect = 0
          console.log("RESET counter")
        },
      };
 //     timeline.push(resultsTraining1);
  
  // Fonction de condition qui contient tout le reste! 
  var ifFailedPreExp = {
    timeline: [
      targetAvoid,
      startTask22, 
      loopTask1,
      resultsTraining1,
      afterLoop1,
      loopTask2,
      resultsTraining1
      ],
    conditional_function: function(){
       return true
    }
}

timeline.push(ifFailedPreExp);	
	
	
	
	
	
	
	
	
	
	
var endDemo = {
      
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
       <p><img src="data:image/png;base64,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" width="200" height="auto"></p>
      
       <p style="font-size:25px;border: 0px solid #000;border-radius: 5px; color:#222;padding: 8px; font-family: sans-serif">Fin de la démonstration</p><hr>
       <p>Merci.</p>
  `,
      choices: ['ALL_KEYS'],
      on_start: function(){
      },
      on_finish: function(){
      },
    };
    
    timeline.push(endDemo);
	
// END CODE ABOVE -------------------------------------------------------------------------------------------------------------

jsPsych.run(timeline);
	
</script>
</html>
